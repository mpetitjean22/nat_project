package main

import (
	"fmt"
	"nat_project/pkg/nat"
)

// Example code for how to use and test nat table functions.
func main() {
	inToOutTable := nat.Table{}
	inToOutTable.AddMapping([4]byte{0x01, 0x01, 0x01, 0x01}, [2]byte{0x00, 0x80}, [4]byte{0x02, 0x02, 0x02, 0x02}, [2]byte{0x00, 0x70})
	inToOutTable.AddMapping([4]byte{0x01, 0x01, 0x01, 0x01}, [2]byte{0x00, 0x80}, [4]byte{0x02, 0x02, 0x02, 0x02}, [2]byte{0x00, 0x50})
	inToOutTable.AddMapping([4]byte{0x03, 0x03, 0x03, 0x03}, [2]byte{0x00, 0x80}, [4]byte{0x04, 0x04, 0x04, 0x04}, [2]byte{0x00, 0x80})
	inToOutTable.AddMapping([4]byte{0x03, 0x03, 0x03, 0x03}, [2]byte{0x00, 0x50}, [4]byte{0x04, 0x04, 0x04, 0x04}, [2]byte{0x00, 0x50})

	outToInNat := nat.Table{}
	outToInNat.AddMapping([4]byte{0x02, 0x02, 0x02, 0x02}, [2]byte{0x00, 0x70}, [4]byte{0x01, 0x01, 0x01, 0x01}, [2]byte{0x00, 0x80})
	outToInNat.AddMapping([4]byte{0x02, 0x02, 0x02, 0x02}, [2]byte{0x00, 0x50}, [4]byte{0x05, 0x05, 0x05, 0x05}, [2]byte{0x00, 0x80})
	outToInNat.AddMapping([4]byte{0x04, 0x04, 0x04, 0x04}, [2]byte{0x00, 0x80}, [4]byte{0x03, 0x03, 0x03, 0x03}, [2]byte{0x00, 0x80})
	outToInNat.AddMapping([4]byte{0x04, 0x04, 0x04, 0x04}, [2]byte{0x00, 0x50}, [4]byte{0x03, 0x03, 0x03, 0x03}, [2]byte{0x00, 0x50})

	inToOutTable.AddDynamicMapping([4]byte{10, 0, 0, 1}, [2]byte{0x98, 0x98}, &outToInNat)

	inToOutTable.PrettyPrintTable()
	outToInNat.PrettyPrintTable()

	dstIP, dstPort, err := inToOutTable.GetMapping([4]byte{0x01, 0x01, 0x01, 0x01}, [2]byte{0x00, 0x80})
	if err != nil {
		fmt.Println("error")
		return
	}
	fmt.Printf("%v %v \n", dstIP, dstPort)

	srcIP, srcPort, err := outToInNat.GetMapping(dstIP, dstPort)
	if err != nil {
		fmt.Println("error")
		return
	}
	fmt.Printf("%v %v \n", srcIP, srcPort)
}
